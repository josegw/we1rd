<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema Contable</title>

<style>
:root{
--azul:#1e3a8a;
--gris:#f3f4f6;
--verde:#16a34a;
--rojo:#dc2626;
}

body{
margin:0;
font-family:Arial, Helvetica, sans-serif;
background:var(--gris);
}

header{
background:var(--azul);
color:white;
padding:15px;
text-align:center;
font-size:20px;
}

.container{
padding:20px;
max-width:1200px;
margin:auto;
}

.card{
background:white;
padding:20px;
border-radius:10px;
box-shadow:0 4px 10px rgba(0,0,0,0.1);
margin-bottom:20px;
}

input, select, button{
padding:8px;
margin:5px 0;
border-radius:6px;
border:1px solid #ccc;
}

button{
background:var(--azul);
color:white;
cursor:pointer;
border:none;
}

button:hover{opacity:0.9;}

table{
width:100%;
border-collapse:collapse;
margin-top:10px;
}

th, td{
border:1px solid #ddd;
padding:8px;
text-align:center;
}

th{background:#e5e7eb;}

.debe{text-align:left;padding-left:20px;}
.haber{text-align:right;padding-right:20px;}

.saldo-deudor{color:var(--rojo);font-weight:bold;}
.saldo-acreedor{color:var(--verde);font-weight:bold;}

.hidden{display:none;}

.tabs button{
margin:5px 5px 5px 0;
background:#374151;
}

.tabs button.active{
background:var(--azul);
}

.alert{
position:fixed;
top:20px;
right:20px;
background:var(--rojo);
color:white;
padding:15px;
border-radius:8px;
z-index:9999;
}

.btn-eliminar{
background:var(--rojo);
padding:4px 8px;
border-radius:4px;
cursor:pointer;
}

@media(max-width:768px){
table{font-size:13px;display:block;overflow-x:auto;}
.tabs{display:flex;flex-wrap:wrap;}
}
</style>
</head>
<body>

<header>Sistema Contable - Rayado Diario</header>

<div class="container">

<div id="inicio" class="card">
<h3>Nuevo Ejercicio</h3>
<input type="text" id="empresa" placeholder="Nombre de la empresa">
<input type="date" id="fecha">
<button onclick="iniciar()">Iniciar</button>
</div>

<div id="sistema" class="hidden">

<div class="card">
<h3>Nueva Cuenta</h3>
<input type="text" id="nuevaCuenta" placeholder="Nombre de la nueva cuenta">
<button onclick="agregarCuenta()">Agregar Cuenta</button>
</div>

<div class="card">
<h3>Nueva Póliza</h3>

<select id="cuenta"></select>

<select id="tipo">
<option value="">Tipo</option>
<option value="Debe">Debe</option>
<option value="Haber">Haber</option>
</select>

<input type="number" id="monto" placeholder="Monto">

<button onclick="agregarMovimiento()">Agregar Movimiento</button>
<button onclick="finalizarPoliza()">Finalizar Póliza</button>

<h4>Vista previa de póliza actual</h4>
<div id="previewPoliza"></div>
</div>

<div class="card">
<button onclick="cerrarEjercicio()">Cerrar Ejercicio</button>
</div>

<div class="card">
<h3>Libro Diario</h3>
<div class="tabs" id="tabsPolizas"></div>
<div id="visorPoliza"></div>
</div>

<div class="card">
<h3>Cuentas T</h3>
<div id="tcuentas"></div>
</div>

<div class="card">
<h3>Balanza de Comprobación</h3>
<div id="balanza"></div>
</div>

</div>
</div>

<!-- LIBRERÍA PDF (AGREGADO, NO AFECTA NADA) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script>
let polizas=[];
let polizaActual=[];
let numeroPoliza=1;
let cuentas=["Caja","Clientes","Mercancías","Proveedores","Capital"];

/* TODO TU CÓDIGO ORIGINAL EXACTAMENTE IGUAL HASTA cerrarEjercicio */

/* -------- FUNCIÓN NUEVA PARA PDF -------- */

function generarPDF(){

let contenido = `
<div style="font-family:Arial; padding:20px;">

<h1 style="text-align:center;">Libro Diario</h1>
${document.getElementById("tabsPolizas").innerHTML}
${document.getElementById("visorPoliza").innerHTML}

<h1 style="margin-top:40px; text-align:center;">Cuentas T</h1>
${document.getElementById("tcuentas").innerHTML}

<h1 style="margin-top:40px; text-align:center;">Balanza de Comprobación</h1>
${document.getElementById("balanza").innerHTML}

</div>
`;

let elemento = document.createElement("div");
elemento.innerHTML = contenido;

html2pdf().set({
margin: 10,
filename: "Ejercicio_Contable.pdf",
html2canvas: { scale: 2 },
jsPDF: { unit: "mm", format: "a4", orientation: "portrait" }
}).from(elemento).save();
}

/* -------- SOLO ESTA FUNCIÓN SE MODIFICÓ -------- */

function cerrarEjercicio(){
if(polizas.length===0){mostrarError("No hay pólizas registradas.");return;}
if(!confirm("¿Deseas cerrar el ejercicio y generar el PDF?"))return;

generarPDF();

setTimeout(()=>{
location.reload();
},1500);
}
</script>

</body>
</html>
